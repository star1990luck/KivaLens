function cameraTransformForCell(e){var t=Math.floor(e/snowstack_options.rows),n=e-t*snowstack_options.rows,o=(t+.5)*CXSPACING,i=(n+.5)*CYSPACING;return magnifyMode?vfx.translate3d(-o,-i,180):vfx.translate3d(-o,-i,0)}function layoutElement(e,t,n){var o=Math.min(CHEIGHT/n,CWIDTH/t);t*=o,n*=o,e.style.width=Math.round(t)+"px",e.style.height=Math.round(n)+"px",e.style.left=Math.round((CWIDTH-t)/2)+"px",e.style.top=Math.round((CHEIGHT-n)/2)+"px"}function play_video(e){currentVideo&&!currentVideo.isPaused()&&currentVideo.setMuted(!0),currentVideo=e,currentVideo.setMuted(!1),currentVideo.play()}function html5video(e,t){var n=vfx.elem("video",{"class":"media"}),o=function(t){return layoutElement(n,n.videoWidth,n.videoHeight),e.parentNode.appendChild(n),e.parentNode.removeChild(e),!1},i=function(e){return play_video(t.video),!1};n.addEventListener("loadedmetadata",o,!1),n.addEventListener("canplay",i,!1),n.src=t.info.video,n.load(),t.video={play:function(){n.play()},pause:function(){n.pause()},isPaused:function(){return n.paused},setMuted:function(e){n.muted=e},isMuted:function(){return n.muted}}}function refreshImage(e,t){return zoomTimer&&clearTimeout(zoomTimer),t.video?void((t.video.isPaused()||t.video.isMuted())&&play_video(t.video)):void(zoomTimer=setTimeout(function(){t.info.zoom&&!t.video&&(e.src=t.info.zoom),zoomTimer=null},2e3))}function setcellclass(e,t){e.div.className=t,e.reflection&&(e.reflection.className=t)}function snowstack_togglemedia(e){var t=cells[e];return t.video?void(t.video.isPaused()?play_video(t.video):t.video.pause()):void(t.info.videoloader?t.info.videoloader(t.divimage,t):t.info.video&&html5video(t.divimage,t))}function snowstack_update(e,t){if(currentCellIndex!=e||magnifyMode!=t){if(-1!=currentCellIndex){var n=cells[currentCellIndex];setcellclass(n,"cell")}if(0!==cells.length){e=Math.min(Math.max(e,0),cells.length-1),currentCellIndex=e;var o=cells[e];magnifyMode=t,magnifyMode?(newbieUser&&(newbieUser=!1),o.div.className="cell magnify",snowstack_options.refreshzoom&&refreshImage(o.divimage,o)):setcellclass(o,"cell selected"),snowstack_options.captions&&!newbieUser&&(caption.innerText=o.info.title),dolly.style.webkitTransform=cameraTransformForCell(e);var i=new WebKitCSSMatrix(document.defaultView.getComputedStyle(dolly,null).webkitTransform),a=new WebKitCSSMatrix(dolly.style.webkitTransform),r=i.m41-a.m41,s=45*Math.min(Math.max(r/(3*CXSPACING),-1),1);camera.style.webkitTransform="rotateY("+s+"deg)",camera.style.webkitTransitionDuration="330ms",currentTimer&&clearTimeout(currentTimer),currentTimer=setTimeout(function(){camera.style.webkitTransform="rotateY(0)",camera.style.webkitTransitionDuration="5s"},330)}}}function snowstack_addimage(e){function t(){var e=vfx.elem("div",{"class":"cell",style:"width: "+CWIDTH+"px; height: "+CHEIGHT+"px"});return e.style.webkitTransform=vfx.translate3d(i*CXSPACING,a*CYSPACING,0),e}var n={},o=cells.length;cells.push(n);var i=Math.floor(o/snowstack_options.rows),a=o-i*snowstack_options.rows;if("string"==typeof e){var r=e;e={thumb:r,zoom:r,title:""}}n.info=e,n.div=t(),n.divimage=vfx.elem("img",{"class":"media"}),vfx.loadhandler(n.divimage,function(){layoutElement(n.divimage,n.divimage.width,n.divimage.height),n.info.link?n.div.appendChild(vfx.elem("a",{"class":"mover view",href:n.info.link,target:"_blank"},n.divimage)):n.div.appendChild(vfx.elem("div",{"class":"mover view"},n.divimage)),n.div.style.opacity=1}),n.div.style.opacity=0,cellstack.appendChild(n.div),n.divimage.src=e.thumb,a==snowstack_options.rows-1&&(n.reflection=t(),n.reflectionimage=vfx.elem("img",{"class":"media reflection"}),vfx.loadhandler(n.reflectionimage,function(){layoutElement(n.reflectionimage,n.reflectionimage.width,n.reflectionimage.height),n.reflection.appendChild(vfx.elem("div",{"class":"mover view"},n.reflectionimage)),n.reflection.style.opacity=1}),n.reflection.style.opacity=0,reflectionstack.appendChild(n.reflection),n.reflectionimage.src=e.thumb)}function snowstack_sort(e){var t;t="date"==e?function(e,t){var n=new Date("1 "+e.info.date),o=new Date("1 "+t.info.date);return o-n}:function(t,n){var o=t.info[e],i=n.info[e];return o>i?1:i>o?-1:0},cells.sort(t);for(var n=0;n<cells.length;++n){var o=Math.floor(n/snowstack_options.rows),i=n-o*snowstack_options.rows;cells[n].div.style.webkitTransform=vfx.translate3d(o*CXSPACING,i*CYSPACING,0)}}function snowstack_startsearch(){camera.style.webkitTransform="translate3d(0, 0, -500px)",camera.style.webkitTransitionDuration="1s"}function snowstack_endsearch(){camera.style.webkitTransform=""}function snowstack_search(e,t){t.length?snowstack_startsearch():snowstack_endsearch();for(var n=new RegExp(t,"i"),o=0;o<cells.length;++o){var i;i=t.length?-1!=cells[o].info[e].search(n):!0,cells[o].div.style.opacity=i?1:.2}}var global=this,CWIDTH,CHEIGHT,CGAP=10,CXSPACING,CYSPACING,snowstack_options={rows:3,refreshzoom:!0,captions:!1},vfx={elem:function(e,t,n){var o=document.createElement(e);if(t)for(var i in t)t.hasOwnProperty(i)&&o.setAttribute(i,t[i]);return n&&o.appendChild(n),o},byid:function(e){return document.getElementById(e)},loadhandler:function(e,t){e.addEventListener("load",t,!1)},translate3d:function(e,t,n){return"translate3d("+e+"px, "+t+"px, "+n+"px)"}},currentCellIndex=-1,cells=[],dolly,camera,caption,cellstack,reflectionstack,magnifyMode,newbieUser=!0,zoomTimer=null,currentTimer=null,currentVideo=null;global.snowstack_init=function(e,t){function n(){var t=currentCellIndex;c.left&&t>=snowstack_options.rows&&(t-=snowstack_options.rows),c.right&&(t+snowstack_options.rows<cells.length?t+=snowstack_options.rows:a||(a=!0,e(function(e){e.forEach(snowstack_addimage),a=!1}))),c.up&&(t-=1),c.down&&(t+=1),snowstack_update(t,magnifyMode)}function o(){n(),f=setTimeout(o,u),u=60}function i(){c.left||c.right||c.up||c.down?null===f&&(u=330,o()):(clearTimeout(f),f=null)}var a=!0;camera=vfx.byid("camera"),reflectionstack=vfx.elem("div",{"class":"view"});var r=vfx.elem("div",{"class":"view"},reflectionstack);for(cellstack=vfx.elem("div",{"class":"view"}),dolly=vfx.elem("div",{"class":"dolly view"}),dolly.appendChild(cellstack),dolly.appendChild(r);camera.hasChildNodes();)camera.removeChild(camera.firstChild);if(camera.appendChild(dolly),t)for(var s in t)t.hasOwnProperty(s)&&(snowstack_options[s]=t[s]);if("function"!=typeof e){var l=e;e=function(e){e(l),l=[]}}CHEIGHT=Math.round(window.innerHeight/(snowstack_options.rows+2)),CWIDTH=Math.round(300*CHEIGHT/180),CXSPACING=CWIDTH+CGAP,CYSPACING=CHEIGHT+CGAP,r.style.webkitTransform="scaleY(-1.0) "+vfx.translate3d(0,-CYSPACING*(2*snowstack_options.rows)-1,0),e(function(e){e.forEach(snowstack_addimage),snowstack_update(Math.floor(snowstack_options.rows/2),!1),a=!1});var c={left:!1,right:!1,up:!1,down:!1},d={37:"left",38:"up",39:"right",40:"down"},f=null,u=330;window.addEventListener("keydown",function(e){32==e.keyCode?snowstack_update(currentCellIndex,!magnifyMode):13==e.keyCode?snowstack_togglemedia(currentCellIndex):c[d[e.keyCode]]=!0,i()}),window.addEventListener("keyup",function(e){c[d[e.keyCode]]=!1,i()});var m=0,v=0,w=document.getElementById("camera");w.addEventListener("touchstart",function(e){return m=event.touches[0].pageX,v=m,e.preventDefault(),!1},!1),w.addEventListener("touchmove",function(e){v=event.touches[0].pageX;var t=v-m;return c.left=t>20,c.right=20>t,n(),m=v,e.preventDefault(),!1},!0),w.addEventListener("touchend",function(e){return c.left=!1,c.right=!1,e.preventDefault(),!1},!0)};